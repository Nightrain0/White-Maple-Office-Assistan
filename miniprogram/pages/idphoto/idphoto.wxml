<view class="container">
  <!-- 顶部标题 -->
  <view class="header">
    <text class="title">白枫办公助手</text>
    <text class="subtitle">智能证件照</text>
  </view>

  <!-- 图片预览区域 (动态高度) -->
  <view class="preview-box" style="width: {{previewWidth}}rpx; height: {{previewHeight}}rpx;">
    <image 
      wx:if="{{currentImage}}" 
      src="{{currentImage}}" 
      mode="aspectFit" 
      class="photo-img"
    ></image>
    <view wx:else class="placeholder" bindtap="chooseImage">
      <text class="icon">+</text>
      <text class="tip">拍摄/上传照片</text>
    </view>
  </view>

  <!-- 1. 尺寸选择器 (新增功能) -->
  <view class="control-panel">
    <text class="section-title">第一步：选择尺寸</text>
    <scroll-view scroll-x class="size-scroll">
      <view class="size-list">
        <view 
          class="size-item {{selectedSize.name === item.name ? 'active' : ''}}" 
          wx:for="{{sizeList}}" 
          wx:key="name" 
          bindtap="changeSize" 
          data-index="{{index}}"
        >
          <text class="size-name">{{item.name}}</text>
          <text class="size-desc">{{item.width}}x{{item.height}}px</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 2. 颜色选择器 -->
  <view class="control-panel" wx:if="{{currentImage}}">
    <text class="section-title">第二步：选择底色</text>
    <view class="colors">
      <view class="color-item {{selectedColor==='red'?'active':''}}" bindtap="changeColor" data-color="red">
        <view class="circle red"></view>
        <text>红底</text>
      </view>
      <view class="color-item {{selectedColor==='blue'?'active':''}}" bindtap="changeColor" data-color="blue">
        <view class="circle blue"></view>
        <text>蓝底</text>
      </view>
      <view class="color-item {{selectedColor==='white'?'active':''}}" bindtap="changeColor" data-color="white">
        <view class="circle white"></view>
        <text>白底</text>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-area">
    <button wx:if="{{!originalImage}}" class="btn-primary" bindtap="chooseImage">上传照片</button>
    <block wx:else>
      <button class="btn-primary" loading="{{processing}}" bindtap="processImage">智能制作</button>
      <button class="btn-secondary" bindtap="saveImageToAlbum" wx:if="{{resultImage}}">保存到相册</button>
    </block>
  </view>

  <!-- 隐藏的画布，用于合成图片 -->
  <canvas 
    type="2d" 
    id="photoCanvas" 
    style="position: absolute; left: -9999px; width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
  ></canvas>

</view>